datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
  output   = "../src/lib/generated/prisma"
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique // æ–°å¢é‚®ç®±
  fullName  String // å®Œæ•´å§“å
  password  String // å¯†ç ï¼ˆåŠ å¯†ä¿å­˜ï¼‰
  role      Role     @default(student) // ç”¨æˆ·è§’è‰²
  createdAt DateTime @default(now()) // æ³¨å†Œæ—¶é—´

  experiments     StudentExperimentLog[]
  aiLogs          AIInteractionLog[]
  classes         ClassMember[]
  teachingClasses Class[]                @relation("TeacherClasses") // âœ… æ–°å¢
}

model Experiment {
  id             Int      @id @default(autoincrement())
  name           String
  subject        Subject  @default(physics)
  description    String?
  sceneAssetPath String
  version        String?
  createdAt      DateTime @default(now())

  logs   StudentExperimentLog[]
  aiLogs AIInteractionLog[]
}

model StudentExperimentLog {
  id               Int       @id @default(autoincrement())
  studentId        Int
  experimentId     Int
  startTime        DateTime  @default(now())
  endTime          DateTime?
  completionStatus String    @default("è¿›è¡Œä¸­")
  recordedData     Json?
  actionsLog       String?

  student    User       @relation(fields: [studentId], references: [id])
  experiment Experiment @relation(fields: [experimentId], references: [id])
}

model AIInteractionLog {
  id              Int      @id @default(autoincrement())
  studentId       Int
  experimentId    Int
  sessionId       String?
  userQuery       String
  aiResponse      String
  contextSnapshot Json?
  createdAt       DateTime @default(now())

  student    User       @relation(fields: [studentId], references: [id])
  experiment Experiment @relation(fields: [experimentId], references: [id])
}

model Class {
  id        Int      @id @default(autoincrement())
  name      String
  teacherId Int
  joinCode  String   @unique // ğŸ”¥ æ–°å¢é‚€è¯·ç 
  createdAt DateTime @default(now())

  teacher User          @relation("TeacherClasses", fields: [teacherId], references: [id]) // âœ… åŒå
  members ClassMember[]
}

model ClassMember {
  id        Int      @id @default(autoincrement())
  classId   Int
  userId    Int
  createdAt DateTime @default(now())

  user  User  @relation(fields: [userId], references: [id])
  class Class @relation(fields: [classId], references: [id])
}

enum Role {
  student
  teacher
  admin
}

enum Subject {
  physics
  chemistry
  biology
}
